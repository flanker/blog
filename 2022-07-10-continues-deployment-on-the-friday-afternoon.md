# 星期五下午六点半，要不要上线？

当然要上线。

## 不上线的理由

已经是星期五下午，马上就下班了。

虽然我们都测过了，但是难免可能还是有遗漏。

万一上线过程出现问题，大家星期五晚上又得加班回滚或者快速解决。

即使上线了，周末大家都休息，可能没有办法及时发现和响应问题。

假如周末出了问题，相关的同事可能也因为休假无法响应，不能及时修复。

算了，我们还是等到下周一再上线吧。

## 周一上线的时候

周一时间是我们客户使用的高峰期，万一上线出了问题影响太大。

算了，要不等周二吧。。。

## 没有信心？

有没有自动化测试？自动化单元测试？自动化集成测试？

足够的自动化测试，应该给团队带来足够的信心。

没有自动化测试覆盖的功能，可以认为就是已经坏了的（broken）。

## CI 100% 的通过，就是 100% 的信心

CI 是干嘛的，就是给团队提供信心的。

如果 CI 不能提供 100% 的信心，那只说明一件事情：CI 有问题。

在我们团队，如果 CI 运行结束是 Successful 的，那就意味着我们有 100% 的信心是可以上线的。

## 万一 CI 真的有问题呢？

是的，没有人能保证，自动化测试、持续集成都是完美的。

但这不是阻拦着团队无法上线的理由。

有过真的有错，那就让错误赶紧暴露（fail fast）。

然后切记，修复错误后，一定再通过自动化的方式，确保这个错误不再发生。

## 灰度发布

任何系统都不可能是 100% 没有问题的。

一般我们会设定一个可用率（例如，99.95%），这也意味着系统会留有 0.05% 的冗余度。

通过灰度发布的方式，例如只给 0.05% 的用户、流量、服务器部署新的代码，即便有问题，也不会影响大多数用户和请求（保证了系统的可用率）。

## 监控和预警

即使有错，也要比客户更早的发现，甚至更早的解决。

前端、后端，都有很多方式来进行监控。

冒烟测试（Smoke Test）、Synthetic Test、APM（Application Performance Monitor）等等各种手段，都需要建立起来。

确保我们的系统可以快速发现和预警线上问题。

## 星期五下午六点半，要不要上线？

有了上面这些手段，「星期五下午六点半，要不要上线？」这个问题还需要回答吗？

任何时候，都可以上线。
